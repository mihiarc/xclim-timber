# Point Extraction Enhancement

## Overview
Enhanced point extraction module for extracting pre-calculated climate indices at specific geographic locations from NetCDF outputs.

## Key Improvements

### 1. **Direct Integration with Pipeline Outputs**
- Reads NetCDF files generated by temperature_pipeline.py
- No recalculation of indices - uses pre-computed values
- Maintains data integrity and consistency

### 2. **Accurate Spatial Interpolation**
- Uses xarray's built-in linear interpolation
- More accurate than nearest-neighbor approximation
- Handles edge cases and missing data gracefully

### 3. **Automatic Unit Conversion**
- Detects temperature values in Kelvin
- Converts to Celsius automatically for usability
- Preserves original units for non-temperature variables

### 4. **Simplified Workflow**
- Single command extracts all 12 climate indices
- Batch processing support for multiple files
- Integration script for end-to-end pipeline

## Usage

### Single File Extraction
```bash
python extract_points.py temperature_indices_2023_2023.nc parcels.csv output.csv
```

### Batch Processing
```bash
python extract_points.py --batch "outputs/temperature_indices_*.nc" --parcels parcels.csv
```

### Integrated Pipeline
```bash
./run_extraction_pipeline.sh 2023 2023
```

## Output Format

CSV file with columns:
- `saleid`: Sale identifier
- `parcelid`: Parcel identifier
- `lat`: Latitude
- `lon`: Longitude
- `[index]_[year]`: Climate index value for each year

Example:
```csv
saleid,parcelid,lat,lon,tg_mean_2023,tx_max_2023,summer_days_2023,...
600007,1,39.7964,-121.445,14.18,38.55,116.49,...
```

## Performance

- **24,012 parcels**: ~1 second extraction time
- **Memory efficient**: Uses lazy loading with xarray
- **Accurate**: Linear interpolation vs nearest neighbor

## Files Created

1. `extract_points.py` - Main extraction module
2. `run_extraction_pipeline.sh` - Integration script
3. Output CSV files with extracted climate indices